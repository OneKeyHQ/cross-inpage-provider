"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9710],{48005:function(e,t,r){r.d(t,{Cm:function(){return useValidateResult},Kj:function(){return ApiPayloadProvider},P3:function(){return tryFormatJson},QT:function(){return useRequest},Qr:function(){return usePresupposeParams},jz:function(){return useApiDispatch},pc:function(){return useResult},ql:function(){return tryFormatCompactJson},t$:function(){return useCurrentParamId}});var a=r(85893),l=r(67294),n=r(86640),s=r.n(n);let i=(0,l.createContext)(""),o=(0,l.createContext)(""),u=(0,l.createContext)(""),c=(0,l.createContext)(""),d=(0,l.createContext)(void 0),p=(0,l.createContext)(null),tryFormatJson=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}},tryFormatCompactJson=e=>{try{let t=/\[.*?\]/.test(e),r=JSON.parse(e);if(t)return s()(r,{singleLine:e=>{let{value:t}=e;return Array.isArray(t)&&t.length>10}});return JSON.stringify(r,null,2)}catch(t){return e}};function apiPayloadReducer(e,t){switch(t.type){case"SET_REQUEST":return{...e,request:tryFormatJson(t.payload)};case"SET_RESULT":return{...e,result:tryFormatCompactJson(t.payload)};case"SET_VALIDATE_RESULT":return{...e,validateResult:tryFormatJson(t.payload)};case"SET_CURRENT_PARAM_ID":return{...e,currentPurposeParamId:t.payload};case"SET_PRESUPPOSE_PARAMS":return{...e,presupposeParams:t.payload};default:return e}}function ApiPayloadProvider(e){let{children:t}=e,[r,n]=(0,l.useReducer)(apiPayloadReducer,{request:"",result:"",validateResult:"",currentPurposeParamId:""}),s=(0,l.useCallback)(n,[]),f=(0,l.useMemo)(()=>r.request,[r.request]),x=(0,l.useMemo)(()=>r.result,[r.result]),m=(0,l.useMemo)(()=>r.validateResult,[r.validateResult]),y=(0,l.useMemo)(()=>r.currentPurposeParamId,[r.currentPurposeParamId]),h=(0,l.useMemo)(()=>r.presupposeParams,[r.presupposeParams]);return(0,a.jsx)(p.Provider,{value:s,children:(0,a.jsx)(i.Provider,{value:f,children:(0,a.jsx)(o.Provider,{value:x,children:(0,a.jsx)(u.Provider,{value:m,children:(0,a.jsx)(c.Provider,{value:y,children:(0,a.jsx)(d.Provider,{value:h,children:t})})})})})})}let useRequest=()=>(0,l.useContext)(i),useResult=()=>(0,l.useContext)(o),useValidateResult=()=>(0,l.useContext)(u),useCurrentParamId=()=>(0,l.useContext)(c),usePresupposeParams=()=>(0,l.useContext)(d),useApiDispatch=()=>{let e=(0,l.useContext)(p);if(!e)throw Error("useApiDispatch must be used within a ApiPayloadProvider");return e}},99710:function(e,t,r){r.d(t,{s:function(){return ApiGroup},u:function(){return ApiPayload}});var a=r(85893),l=r(67294),n=r(23225),s=r(27361),i=r.n(s),o=r(88240),u=r(96544);function useApiExecutor(e){let{onExecute:t,onValidate:r}=e,{toast:a}=(0,u.pm)(),n=(0,l.useCallback)(async e=>{try{let r;let a=await t(e);return{result:null!=(r="number"==typeof a||"boolean"==typeof a||"string"==typeof a?a.toString():(0,o.a)(a))?r:"null",error:void 0}}catch(t){console.log("execute error",t);let e="";try{e=JSON.stringify(t)}catch(t){e=i()(t,"message","Execution error")}return{result:void 0,error:e}}},[t]),s=(0,l.useCallback)(async(e,t)=>{try{let a;let l=await r(e,t);return{validation:null!=(a="number"==typeof l||"boolean"==typeof l||"string"==typeof l?l.toString():(0,o.a)(l))?a:"null",error:void 0}}catch(e){return a({title:"验证失败",description:i()(e,"message","验证失败"),variant:"destructive"}),console.log("validate error",e),{validation:void 0,error:i()(e,"message","Validation error")}}},[r,a]);return{execute:n,validate:s}}var c=r(51731),d=r(49333),p=r(48005);function PresupposeParamsSelector(e){var t,r;let{onPresupposeParamChange:n}=e,s=(0,p.Qr)(),i=(0,p.t$)(),o=(0,p.jz)();(0,l.useEffect)(()=>{s&&s.length>0&&(o({type:"SET_CURRENT_PARAM_ID",payload:s[0].id}),null==n||n(s[0].id))},[o,s]),(0,l.useEffect)(()=>{var e;let t=null==s?void 0:s.find(e=>e.id===i);o({type:"SET_REQUEST",payload:null!==(e=null==t?void 0:t.value)&&void 0!==e?e:""})},[i,o,s]);let u=(0,l.useCallback)(e=>{o({type:"SET_CURRENT_PARAM_ID",payload:e}),null==n||n(e)},[o]),c=s&&s.length>1,f=null==s?void 0:null===(t=s.find(e=>e.id===i))||void 0===t?void 0:t.description;return c?(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-base font-medium",children:"预设参数"}),(0,a.jsxs)(d.Ph,{defaultValue:null===(r=s[0])||void 0===r?void 0:r.id,value:i,onValueChange:u,children:[(0,a.jsx)(d.i4,{className:"w-full",children:(0,a.jsx)(d.ki,{className:"text-base font-medium",placeholder:"选择参数"})}),(0,a.jsx)(d.Bw,{children:null==s?void 0:s.map(e=>(0,a.jsx)(d.Ql,{value:e.id,className:"text-base font-medium",children:e.name||e.description},e.id))})]}),f&&(0,a.jsx)("p",{className:"px-2 text-base text-muted-foreground",children:f})]}):null}var f=r(9663),x=r(20176),m=r(13718);function ResetRequest(){let e=(0,p.Qr)(),t=(0,p.t$)(),r=(0,p.jz)(),n=(0,l.useCallback)(()=>{var a;let l=null==e?void 0:null===(a=e.find(e=>e.id===t))||void 0===a?void 0:a.value;r({type:"SET_REQUEST",payload:l}),r({type:"SET_RESULT",payload:""}),r({type:"SET_VALIDATE_RESULT",payload:""})},[r,e,t]);return(0,a.jsx)(f.z,{variant:"outline",size:"sm",onClick:n,children:"Rest 请求"})}function RequestEditor(e){let{disableRequestContent:t,generateRequestFrom:r,onGenerateRequest:n}=e,s=(0,p.QT)(),o=(0,p.jz)(),[c,d]=(0,l.useState)(!1),y=(0,l.useCallback)(e=>{o({type:"SET_REQUEST",payload:e})},[o]),h=(0,l.useCallback)(async e=>{e.preventDefault();let t=new FormData(e.currentTarget),r={};t.forEach((e,t)=>{r[t]=e});try{d(!0);let e=await n(r);y(e)}catch(e){console.log("error",e),(0,u.Am)({title:"生成请求失败",description:i()(e,"message","")})}finally{d(!1)}},[y,n]);return(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between items-end",children:[(0,a.jsxs)("span",{className:"text-base font-medium",children:["请求",!t&&(0,a.jsx)("span",{children:"(可以手动编辑)"})]}),(0,a.jsx)(ResetRequest,{})]}),n&&(0,a.jsxs)("form",{onSubmit:h,className:"p-2 m-2 gap-1 flex flex-col",children:[null==r?void 0:r(),(0,a.jsx)(f.z,{loading:c,variant:"outline",type:"submit",children:"生成请求"})]}),t?(0,a.jsx)(x.i,{className:"min-h-4",placeholder:"Not Request",readOnly:!0}):(0,a.jsx)(m.Z,{value:null!=s?s:"",onChange:y})]})}function ResultTextArea(e){let{label:t,content:r}=e;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,a.jsx)("span",{className:"text-base font-medium",children:t}),(0,a.jsx)(f.z,{variant:"link",size:"sm",onClick:()=>{navigator.clipboard.writeText(null!=r?r:"").then(()=>{(0,u.Am)({title:"复制成功"})}).catch(e=>{console.error("Failed to copy text: ",JSON.stringify(e))})},children:"Copy"})]}),(0,a.jsx)(x.i,{value:null!=r?r:"",placeholder:"".concat(t,"展示在这里"),readOnly:!0,className:"min-h-12"})]})}let InitPresupposeParams=e=>{let{presupposeParams:t}=e,r=(0,p.jz)();return(0,l.useEffect)(()=>{r({type:"SET_PRESUPPOSE_PARAMS",payload:t})},[t,r]),null};function ApiPayloadContent(e){let{title:t,description:r,presupposeParams:l,onExecute:n,onValidate:s,onPresupposeParamChange:i,generateRequestFrom:o,onGenerateRequest:u,allowCallWithoutProvider:d,disableRequestContent:p}=e;return(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(InitPresupposeParams,{presupposeParams:l}),(0,a.jsx)(c.Ol,{className:"text-xl font-medium searchable",children:t}),r&&(0,a.jsx)(c.SZ,{children:r}),(0,a.jsx)(c.aY,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(PresupposeParamsSelector,{onPresupposeParamChange:i}),(0,a.jsx)(RequestEditor,{generateRequestFrom:o,onGenerateRequest:u,disableRequestContent:p}),(0,a.jsx)(ApiExecute,{allowCallWithoutProvider:d,onExecute:n}),(0,a.jsx)(ExecuteResultDisplay,{}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ApiExecuteValidate,{onExecute:n,onValidate:s}),(0,a.jsx)(ValidateResultDisplay,{})]})]})})]})}function ApiPayload(e){return(0,a.jsx)(p.Kj,{children:(0,a.jsx)(ApiPayloadContent,{...e})})}function ApiExecute(e){let{allowCallWithoutProvider:t,onExecute:r,onValidate:s,timeout:i=3e5}=e,{provider:o}=(0,n.O)(),{execute:u}=useApiExecutor({onExecute:r,onValidate:s}),c=(0,p.QT)(),d=(0,p.jz)(),[x,m]=(0,l.useState)(!1),y=(0,l.useCallback)(e=>{d({type:"SET_RESULT",payload:e})},[d]),h=(0,l.useCallback)(e=>{d({type:"SET_VALIDATE_RESULT",payload:e})},[d]),v=(0,l.useCallback)(async()=>{m(!0),y("Calling..."),h("");try{let{result:e,error:t}=await Promise.race([u(c),new Promise((e,t)=>setTimeout(()=>t("call timeout ".concat(i,"ms")),i))]);t?y("Error: ".concat(t)):y(e)}catch(e){console.log("execute error",e),y("Error: ".concat("string"==typeof e?e:JSON.stringify(e)))}m(!1)},[u,c,y]);return(0,a.jsx)(f.z,{loading:x,disabled:!o&&!t,onClick:v,children:"Call"})}function ApiExecuteValidate(e){let{onExecute:t,onValidate:r}=e,n=(0,p.QT)(),s=(0,p.pc)(),i=(0,p.jz)(),{validate:o}=useApiExecutor({onExecute:t,onValidate:r}),u=(0,l.useCallback)(e=>{i({type:"SET_VALIDATE_RESULT",payload:e})},[i]),c=(0,l.useCallback)(async()=>{u("Validating...");let{validation:e,error:t}=await o(n,s);t?u("Error: ".concat(t)):u(e)},[o,n,s,u]);return(0,a.jsx)(f.z,{disabled:!s,onClick:c,children:"Validate"})}function ExecuteResultDisplay(){let e=(0,p.pc)();return(0,a.jsx)(ResultTextArea,{label:"执行结果",content:e})}function ValidateResultDisplay(){let e=(0,p.Cm)();return(0,a.jsx)(ResultTextArea,{label:"验证结果",content:e})}function ApiGroup(e){let{title:t,children:r}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-medium mt-4 mb-2",children:t}),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 3xl:grid-cols-4 gap-3",children:r})]})}},51731:function(e,t,r){r.d(t,{Ol:function(){return i},SZ:function(){return u},Zb:function(){return s},aY:function(){return c},ll:function(){return o}});var a=r(85893),l=r(67294),n=r(13441);let s=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow-sm p-3",r),...l})});s.displayName="Card";let i=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex p-1 flex-col space-y-1.5",r),...l})});i.displayName="CardHeader";let o=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...l})});o.displayName="CardTitle";let u=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("px-3 text-base text-muted-foreground",r),...l})});u.displayName="CardDescription";let c=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-1 pt-0",r),...l})});c.displayName="CardContent";let d=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-1 pt-0",r),...l})});d.displayName="CardFooter"},13718:function(e,t,r){var a=r(85893),l=r(67294),n=r(32595),s=r(6248),i=r(28519);t.Z=e=>{let{value:t,placeholder:r,onChange:o}=e,[u,c]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{t.trim().startsWith("{")||t.trim().startsWith("[")?c(!0):c(!1)},[t]),(0,a.jsx)(n.ZP,{className:"text-sm overflow-auto max-h-[500px]",value:t,"data-test":"json-editor",placeholder:r,extensions:[u?(0,s.AV)():[],u?(0,i.ir)((0,s.ap)()):[],u?(0,i.Q2)():[],n.tk.lineWrapping],onChange:(e,t)=>{o(e)},basicSetup:{lineNumbers:!1},height:"auto",theme:"light"})}},20176:function(e,t,r){r.d(t,{g:function(){return s},i:function(){return AutoHeightTextarea}});var a=r(85893),l=r(67294),n=r(13441);let s=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});s.displayName="Textarea";let AutoHeightTextarea=e=>{let t=l.useRef(null),r=l.useCallback(()=>{let r=t.current;r&&(r.style.height="auto",e.maxHeight?r.style.height="".concat(Math.min(r.scrollHeight,e.maxHeight),"px"):r.style.height="".concat(r.scrollHeight,"px"))},[e.maxHeight]);return l.useEffect(()=>{r()},[r,e.value]),(0,a.jsx)(s,{...e,ref:t,onInput:r,style:{...e.style,overflow:"hidden"}})}},88240:function(e,t,r){r.d(t,{a:function(){return stringifyWithSpecialType}});var a=r(48764).Buffer;function stringifyWithSpecialType(e){return e instanceof Uint8Array?JSON.stringify(Array.from(e)):JSON.stringify(e,(e,t)=>t instanceof a||t instanceof Uint8Array?Array.from(t):t)}}}]);
//# sourceMappingURL=9710.4fa3a978d39ccbef.js.map