(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2728],{86201:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return BTCExample}});var s=t(85893);let a=[{name:"MoonSwap",url:"https://moonswap.fi/exchange/swap"},{name:"ShuttleFlow",url:"https://shuttleflow.io/shuttle"},{name:"CONFLUXSCAN",url:"https://confluxscan.io/"},{name:"Stampers",url:"https://stampers.app/"}];var i=t(87066),r=t(6912),l=t(67294),o=t(27361),c=t.n(o),d=t(99710),u=t(23225),x=t(6793),p=t(72401),h={requestPermissions:[{id:"cfx_accounts",name:"cfx_accounts",description:"请求权限",value:JSON.stringify({cfx_accounts:{}})},{id:"cfx_accounts and cfx_chainId",name:"cfx_accounts cfx_chainId",description:"请求权限",value:JSON.stringify({cfx_accounts:{},cfx_chainId:{}})}],requestMothed:[{id:"request",name:"request",description:"request eth mothed",value:JSON.stringify({method:"cfx_requestAccounts",params:[]})}],addConfluxChain:[{id:"wallet_addConfluxChain",name:"Add Conflux Chain",description:"Add Conflux Chain",value:JSON.stringify({chainId:"0x47",chainName:"EVM Conflux",nativeCurrency:{name:"Conflux",symbol:"CFX",decimals:18},rpcUrls:["https://evmtestnet.confluxrpc.com"],blockExplorerUrls:["https://evmtestnet.confluxscan.io"]})}],switchConfluxChain:[{id:"switchConfluxChain",name:"Switch Conflux Chain",value:JSON.stringify({chainId:"0x1"})}],watchAsset:[{id:"watchAsset erc20",name:"添加 ERC20 资产",description:"添加 ERC20 资产",value:JSON.stringify({type:"ERC20",options:{address:"cfxtest:acepe88unk7fvs18436178up33hb4zkuf62a9dk1gv",symbol:"cUSDT",decimals:18,image:"https://scan-icons.oss-cn-hongkong.aliyuncs.com/testnet/cfxtest%3Aacepe88unk7fvs18436178up33hb4zkuf62a9dk1gv.png"}})}],cfxSign:[{id:"eth_sign",name:"eth_sign",description:"eth_sign 有安全风险，硬件不支持",value:"0x879a053d4800c6354e76c7985a865d2922c82fb5b3f4577b2fe08b998954f2e0"}],personalSign:[{id:"personal_sign",name:"personal_sign",description:"personalSign",value:"personal sign message example"}],signTypedDataV4:[{id:"signTypedDataV4",name:"signTypedDataV4",description:"signTypedDataV4",value:JSON.stringify({domain:{chainId:"1029",name:"Ether Mail",verifyingContract:"0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC",version:"1"},message:{contents:"Hello, Bob!",from:{name:"Cow",wallets:["0xCD2a3d9F938E13CD947Ec05AbC7FE734Df8DD826","0xDeaDbeefdEAdbeefdEadbEEFdeadbeEFdEaDbeeF"]},to:[{name:"Bob",wallets:["0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB","0xB0BdaBea57B0BDABeA57b0bdABEA57b0BDabEa57","0xB0B0b0b0b0b0B000000000000000000000000000"]}],attachment:"0x"},primaryType:"Mail",types:{CIP23Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Group:[{name:"name",type:"string"},{name:"members",type:"Person[]"}],Mail:[{name:"from",type:"Person"},{name:"to",type:"Person[]"},{name:"contents",type:"string"},{name:"attachment",type:"bytes"}],Person:[{name:"name",type:"string"},{name:"wallets",type:"address[]"}]}})}],sendTransaction:(e,n)=>e&&n?[{id:"sendTransaction",name:"sendTransaction",description:"发送原生代币",value:JSON.stringify({from:e,to:n,value:"0x1"})},{id:"sendTransaction-eip1559",name:"sendTransaction EIP1559",description:"发送原生代币(EIP1559)",value:JSON.stringify({from:e,to:n,value:"0x1"})},{id:"sendTransaction-crc20-moon",name:"CRC20 Token Transfer(Moon)",description:"发送 CRC20 代币 Moon",value:JSON.stringify({from:e,to:"cfx:achcuvuasx3t8zcumtwuf35y51sksewvca0h0hj71a",data:["0xa9059cbb",p.address.decodeCfxAddress(n).hexAddress.toString("hex").slice(2).padStart(64,"0"),"00000000000000000000000000000000000000000000000000005af3107a4000"].join("")},null,2)},{id:"sendTransaction-crc20-usdt",name:"CRC20 Token Transfer(USDT)",description:"发送 CRC20 代币 USDT",value:JSON.stringify({from:e,to:"cfx:acf2rcsh8payyxpg6xj7b0ztswwh81ute60tsw35j7",data:["0xa9059cbb",p.address.decodeCfxAddress(n).hexAddress.toString("hex").slice(2).padStart(64,"0"),"00000000000000000000000000000000000000000000000000005af3107a4000"].join("")},null,2)}]:[]},m=t(30319),f=t(96544),C=t(34251),g=t(9561),v=t(22751),y=t(25618),w=t(48764).Buffer;function recoverAddress(e,n){let t=function(e,n){let t=C.toBuffer(n),s=C.fromRpcSig(C.addHexPrefix(t.toString("hex")));return C.ecrecover(e,s.v,s.r,s.s)}(e,n),s=C.publicToAddress(t);return C.bufferToHex(s)}let WalletWatchAsset=e=>{let{chainId:n}=e,t=(0,l.useRef)(null),a=(0,l.useRef)(null),{provider:r}=(0,u.O)();return(0,l.useEffect)(()=>{i.Z.get("https://testingcf.jsdelivr.net/gh/conflux-fans/token-list@master/cfx.fluent.json").then(e=>{var n;let t=e.data.tokens,s=t.map(e=>({value:e.address,label:"".concat(e.name," - ").concat(e.address),extra:{type:"CRC20",options:{address:e.address,symbol:e.symbol,decimals:e.decimals,image:e.logoURI}}}));null===(n=a.current)||void 0===n||n.setOptions(s)})},[n]),(0,s.jsxs)(y.s,{title:"wallet_watchAsset CRC20",description:"添加 CRC20 资产",ref:t,children:[(0,s.jsx)(y.s.Combobox,{ref:a,id:"tokenSelector",label:"预设参数",placeholder:"请选择 CRC20 Token",onOptionChange:e=>{var n;null===(n=t.current)||void 0===n||n.setJsonValue("request",null==e?void 0:e.extra)}}),(0,s.jsx)(y.s.JsonEdit,{id:"request",label:"请求(可以手动编辑)",required:!0}),(0,s.jsx)(y.s.Button,{id:"watchButton",label:"观察 Asset",onClick:async()=>{var e,n,s;let a=await (null==r?void 0:r.request({method:"wallet_watchAsset",params:JSON.parse(null!==(s=null===(e=t.current)||void 0===e?void 0:e.getValue("request"))&&void 0!==s?s:"")}));null===(n=t.current)||void 0===n||n.setValue("response",JSON.stringify(a,null,2))},validation:{fields:["request"],validator:e=>{if(!e.request)return"请选择 CRC20 Token"}}}),(0,s.jsx)(y.s.TextArea,{id:"response",label:"执行结果"})]})};function BTCExample(){var e,n,t,i;let o=(0,l.useRef)([{uuid:"injected",name:"Injected Wallet",inject:"conflux"},{uuid:"injected-onekey",name:"Injected OneKey",inject:"$onekey.conflux"}]),{provider:C,setAccount:y,account:b}=(0,u.O)(),onConnectWallet=async e=>{var n;let t=null===(n=o.current)||void 0===n?void 0:n.find(n=>n.uuid===e.id);if(!t)return Promise.reject("Wallet not found");let s=c()(window,t.inject);if(!s){(0,f.Am)({title:"Wallet not found",description:"Please install the wallet extension"});return}await (null==s?void 0:s.request({method:"cfx_requestAccounts"}));let[a]=await s.request({method:"cfx_accounts"}),[i]=await s.request({method:"cfx_chainId"});return{provider:s,address:a,chainId:i}};return(0,l.useEffect)(()=>{let accountsChangedHandler=e=>{console.log("cfx [accountsChanged]",e),e.length&&y({...b,address:e[0]})},chainChangedHandler=e=>{console.log("cfx [chainChanged]",e),e&&y({...b,chainId:e})},connectHandler=e=>{console.log("cfx [connect]",e)},disconnectHandler=e=>{console.log("cfx [disconnect]",e)};return null==C||C.on("accountsChanged",accountsChangedHandler),null==C||C.on("chainChanged",chainChangedHandler),null==C||C.on("connect",connectHandler),null==C||C.on("disconnect",disconnectHandler),()=>{null==C||C.removeListener("accountsChanged",accountsChangedHandler),null==C||C.removeListener("chainChanged",chainChangedHandler),null==C||C.removeListener("connect",connectHandler),null==C||C.removeListener("disconnect",disconnectHandler)}},[b,C,y]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z,{fetchWallets:()=>Promise.resolve(o.current.map(e=>({id:e.uuid,name:e.name}))),onConnect:onConnectWallet}),(0,s.jsxs)(d.s,{title:"Basics",children:[(0,s.jsx)(d.u,{title:"cfx_requestAccounts",description:"连接钱包",disableRequestContent:!0,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"cfx_requestAccounts"}));return JSON.stringify(n)}}),(0,s.jsx)(d.u,{title:"enable",description:"（废弃）连接钱包",disableRequestContent:!0,onExecute:async e=>{let n=await (null==C?void 0:C.enable());return JSON.stringify(n)}}),(0,s.jsx)(d.u,{title:"isConnected",description:"（isConnected",disableRequestContent:!0,onExecute:async e=>{let n=await (null==C?void 0:C.isConnected());return JSON.stringify(n)}}),(0,s.jsx)(d.u,{title:"cfx_accounts",description:"获取账户",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"cfx_accounts"}));return JSON.stringify(e)}}),(0,s.jsx)(d.u,{title:"net_version",description:"获取网络",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"net_version"}));return e}}),(0,s.jsx)(d.u,{title:"cfx_chainId",description:"获取 chainId",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"cfx_chainId"}));return e}}),(0,s.jsx)(d.u,{title:"cfx_getMaxGasLimit",description:"获取最大 Gas Limit",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"cfx_getMaxGasLimit",params:[b.address]}));return JSON.stringify(e)}}),(0,s.jsx)(d.u,{title:"cfx_getNextUsableNonce",description:"获取下一个可用 Nonce",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"cfx_getNextUsableNonce",params:[b.address]}));return e}}),(0,s.jsx)(d.u,{title:"wallet_getBalance",description:"获取余额",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"wallet_getBalance",params:[b.address]}));return e}}),(0,s.jsx)(d.u,{title:"wallet_getBlockTime",description:"（暂不支持）获取区块时间",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"wallet_getBlockTime"}));return JSON.stringify(e)}}),(0,s.jsx)(d.u,{title:"wallet_getBlockchainExplorerUrl",description:"（暂不支持）获取区块链浏览器地址",disableRequestContent:!0,onExecute:async()=>{let e=await (null==C?void 0:C.request({method:"wallet_getBlockchainExplorerUrl"}));return JSON.stringify(e)}}),(0,s.jsx)(d.u,{title:"wallet_requestPermissions",description:"获取账户权限",presupposeParams:h.requestPermissions,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"wallet_requestPermissions",params:[JSON.parse(e)]}));return JSON.stringify(n)}}),(0,s.jsx)(d.u,{title:"request",description:"request 调用 eth 各种 RPC 方法",presupposeParams:h.requestMothed,onExecute:async e=>{let n=JSON.parse(e),t=await (null==C?void 0:C.request({method:n.method,params:n.params}));return JSON.stringify(t)}}),(0,s.jsx)(d.u,{title:"send",description:"send 调用 eth 各种 RPC 方法",presupposeParams:h.requestMothed,onExecute:async e=>{let n=JSON.parse(e),t=await (null==C?void 0:C.send({method:n.method,params:n.params}));return JSON.stringify(t)}}),(0,s.jsx)(d.u,{title:"sendAsync",description:"sendAsync 调用 eth 各种 RPC 方法",presupposeParams:h.requestMothed,onExecute:async e=>new Promise(n=>{let t=JSON.parse(e);null==C||C.sendAsync({method:t.method,params:t.params},(e,t)=>{n(JSON.stringify(t))})})})]}),(0,s.jsxs)(d.s,{title:"Chain",children:[(0,s.jsx)(d.u,{title:"wallet_addConfluxChain",description:"（暂不支持）添加 Chain",presupposeParams:h.addConfluxChain,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"wallet_addConfluxChain",params:[JSON.parse(e)]}));return JSON.stringify(n)}}),(0,s.jsx)(d.u,{title:"wallet_switchConfluxChain",description:"（暂不支持）切换 Chain",presupposeParams:h.addConfluxChain,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"wallet_switchConfluxChain",params:[JSON.parse(e)]}));return JSON.stringify(n)}}),(0,s.jsx)(d.u,{title:"wallet_watchAsset",description:"（暂不支持）添加 Token",presupposeParams:h.watchAsset,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"wallet_watchAsset",params:[JSON.parse(e)]}));return JSON.stringify(n)}})]}),(0,s.jsxs)(d.s,{title:"Sign Message",children:[(0,s.jsx)(d.u,{title:"(不支持) cfx_sign",description:"cfx_sign",presupposeParams:h.cfxSign,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"cfx_sign",params:[b.address,e],from:b.address}));return n},onValidate:async(e,n)=>{var t;let s=(0,v.keccak256)(w.from(e)),a=recoverAddress(s,n);return Promise.resolve(((null===(t=a.replace("0x",""))||void 0===t?void 0:t.toLowerCase())===p.address.decodeCfxAddress(b.address).hexAddress.toString("hex")).toString())}}),(0,s.jsx)(d.u,{title:"personal_sign",description:"personal_sign",presupposeParams:h.personalSign,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"personal_sign",params:[e,b.address,"Example password"]}));return n},onValidate:async(e,n)=>{var t;let s=(0,m.recoverPersonalSignature)({data:e,sig:n});return Promise.resolve(((null===(t=s.replace("0x",""))||void 0===t?void 0:t.toLowerCase())===p.address.decodeCfxAddress(b.address).hexAddress.toString("hex")).toString())}}),(0,s.jsx)(d.u,{title:"cfx_signTypedData_v4",description:"signTypedDataV4",presupposeParams:h.signTypedDataV4,onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"cfx_signTypedData_v4",params:[b.address,e]}));return n},onValidate:async(e,n)=>{var t;let s=(0,v.keccak256)((0,g.FC)(JSON.parse(e))),a=recoverAddress(s,n);return console.log("hexAddress",a),Promise.resolve(((null===(t=a.replace("0x",""))||void 0===t?void 0:t.toLowerCase())===p.address.decodeCfxAddress(b.address).hexAddress.toString("hex")).toString())}})]}),(0,s.jsxs)(d.s,{title:"Transaction",children:[(0,s.jsx)(d.u,{title:"cfx_sendTransaction",description:"发送交易",presupposeParams:h.sendTransaction(null!==(e=null==b?void 0:b.address)&&void 0!==e?e:"",null!==(n=null==b?void 0:b.address)&&void 0!==n?n:""),onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"cfx_sendTransaction",params:[JSON.parse(e)]}));return n}}),(0,s.jsx)(d.u,{title:"wallet_sendTransaction",description:"发送交易",presupposeParams:h.sendTransaction(null!==(t=null==b?void 0:b.address)&&void 0!==t?t:"",null!==(i=null==b?void 0:b.address)&&void 0!==i?i:""),onExecute:async e=>{let n=await (null==C?void 0:C.request({method:"wallet_sendTransaction",params:[JSON.parse(e)]}));return n}})]}),(0,s.jsx)(d.s,{title:"wallet_watchAsset (EIP 747)",children:(0,s.jsx)(WalletWatchAsset,{chainId:null==b?void 0:b.chainId})}),(0,s.jsx)(x.Z,{dapps:a})]})}},6912:function(e,n,t){"use strict";t.d(n,{Z:function(){return ConnectButton}});var s=t(85893),a=t(67294),i=t(9663),r=t(51731),l=t(53617),o=t(23225),c=t(96544),d=t(27361),u=t.n(d),x=t(78299);let p={address:"地址",publicKey:"公钥",chainId:"网络"};function ConnectButton(e){let{fetchWallets:n,onConnect:t,onDisconnect:d}=e,{settings:h}=(0,x.r)(),m=(0,a.useRef)(null),f=(0,a.useRef)(!1),[C,g]=(0,a.useState)([]),{setProvider:v,setAccount:y,provider:w,account:b}=(0,o.O)(),j=(0,a.useCallback)(async e=>{try{let{provider:n,...s}=await t(e);v(n),y(s)}catch(e){console.log("connectWallet error",e),(0,c.Am)({title:"连接失败",description:u()(e,"message","")})}},[t,y,v]),_=(0,a.useCallback)(async()=>{f.current=!1,await (null==d?void 0:d()),v(null),y(null)},[d,y,v]),S=(0,a.useCallback)(()=>{setTimeout(()=>{try{var e;null===(e=m.current)||void 0===e||e.click()}catch(e){}},150)},[]),q=(0,a.useCallback)(async e=>{let t=await (null==n?void 0:n());if((null==t?void 0:t.length)===0){S();return}let{directConnection:s}=null!=e?e:{directConnection:!1};(null==t?void 0:t.length)===1||(null==t?void 0:t.length)>0&&s?(S(),await j(t[0])):g(t)},[S,j,n]);return(0,a.useEffect)(()=>{let e=setTimeout(async()=>{!f.current&&(console.log("settings.autoConnect",h.autoConnect),h.autoConnect&&(f.current=!0,await q({directConnection:!0})))},500);return()=>{clearTimeout(e)}},[h.autoConnect]),(0,s.jsx)(r.Zb,{children:(0,s.jsxs)(r.aY,{className:"flex flex-col flex-wrap gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-row flex-wrap justify-between",children:[(0,s.jsxs)(l.Vq,{children:[(0,s.jsx)(l.hg,{asChild:!0,children:(0,s.jsx)(i.z,{onClick:()=>q(),children:"Connect Wallet"})}),(0,s.jsxs)(l.cZ,{children:[(0,s.jsx)(l.GG,{ref:m}),(0,s.jsxs)(l.fK,{children:[(0,s.jsx)(l.$N,{children:"选择钱包开始连接"}),!!C&&C.map(e=>{var n;return(0,s.jsx)(l.GG,{asChild:!0,children:(0,s.jsxs)(i.z,{onClick:()=>j(e),className:"gap-2",children:[e.logo&&(0,s.jsx)("img",{alt:e.name,src:e.logo,className:"w-5 h-5 rounded-full"}),(0,s.jsx)("span",{className:"font-medium",children:e.name}),null===(n=e.tags)||void 0===n?void 0:n.map(e=>(0,s.jsx)("span",{className:"text-xs font-light",children:e},e))]})},e.id)}),!C||0===C.length&&(0,s.jsxs)(l.Be,{children:["没有钱包可用，请安装 OneKey Extension",(0,s.jsx)("a",{target:"_blank",href:"https://www.onekey.so/download/",children:"Install OneKey Extension →"})]})]})]})]}),w&&(0,s.jsx)(i.z,{variant:"destructive",onClick:_,children:"断开链接"})]}),b&&(0,s.jsx)("div",{className:"flex grid-cols-1 xl:grid-cols-2 flex-wrap gap-x-6 gap-y-3 mt-4",children:Object.keys(b).map(e=>{var n;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{children:["".concat(null!==(n=null==p?void 0:p[e])&&void 0!==n?n:e),": "]}),(0,s.jsx)("span",{className:"font-normal flex flex-wrap text-break",children:"".concat(null==b?void 0:b[e])})]},e)})})]})})}},4856:function(){},46601:function(){},89214:function(){},83512:function(){},85568:function(){},52361:function(){},94616:function(){},22644:function(){}}]);
//# sourceMappingURL=2728.989a08f49f159deb.js.map