"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4395],{50615:function(e,n,t){t.d(n,{Z:function(){return InfoLayout}});var s=t(85893),a=t(51731);function InfoLayout(e){let{title:n,children:t}=e;return(0,s.jsxs)(a.Zb,{children:[n&&(0,s.jsx)(a.Ol,{className:"font-medium",children:n}),(0,s.jsx)(a.aY,{className:"flex flex-col flex-wrap gap-3 break-all",children:t})]})}},14395:function(e,n,t){t.r(n),t.d(n,{default:function(){return App},normalizeSuiCoinType:function(){return normalizeSuiCoinType}});var s=t(85893);let a=[{name:"Bluefin",url:"https://trade.bluefin.io/"},{name:"Cetus",url:"https://app.cetus.zone/"},{name:"SuiSwap",url:"https://suiswap.app/"},{name:"Sui Names",url:"https://sui-names.com/"}];var i=t(67294),r=t(66409),l=t(23225),o=t(6793),c={signMessage:[{id:"signMessage hello",name:"signData Hello",value:"48656c6c6f204f6e654b6579"},{id:"signMessage",name:"signMessage",value:"010203"}],signPersonalMessage:[{id:"signPersonalMessage hello",name:"signPersonalMessage Hello",value:"48656c6c6f204f6e654b6579"},{id:"signPersonalMessage",name:"signPersonalMessage",value:"010203"}],signTransaction:e=>[{id:"signTransaction",name:"signTransaction",value:JSON.stringify({from:e,to:e,amount:1e5})}],signTokenTransaction:e=>[{id:"signUSDCransaction",name:"USDC_TYPE",value:JSON.stringify({from:e,to:e,amount:1e3,token:"0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"})}]},u=t(44714),d=t(2764),p=t(28765),f=t(28966),g=t(50615),m=t(18),v=t(15680),w=t(8590),y=t(30202);t(40224);var h=t(98029),x=t(99710);async function sponsorTransaction(e,n,t){arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.uq;let s=[],a=await e.getCoins({owner:n,limit:1});a.data.length>0&&(s=a.data.map(e=>({objectId:e.coinObjectId,version:e.version,digest:e.digest})));let i=m.Y.fromKind(t);return i.setSender(n),i.setGasOwner(n),i.setGasPayment(s),i}var b=t(25618),j=t(70794),S=t(48583),T=t(77844),O=t(48764).Buffer;function normalizeSuiCoinType(e){if(e!==d.uq){let[n,t,s]=e.split("::");if(t&&s)try{return"".concat((0,p.yT)(n).toLowerCase(),"::").concat(t,"::").concat(s)}catch(e){}}return e}function AssetInfoView(e){let{viewRef:n,client:t}=e,{store:a}=(0,T.G)(),[r]=(0,S.KO)(a.fieldAtom("asset"));return(0,i.useEffect)(()=>{n&&(async()=>{try{let e=await t.getCoinMetadata({coinType:r.value});null==n||n.setValue("assetInfo","name: ".concat(null==e?void 0:e.name,", symbol: ").concat(null==e?void 0:e.symbol,", decimals: ").concat(null==e?void 0:e.decimals)),null==n||n.setValue("assetDecimals",null==e?void 0:e.decimals)}catch(e){console.error(e)}})()},[t,r.value,n]),(0,s.jsx)(s.Fragment,{})}function TransferForm(){let e=(0,f.nf)(),n=(0,f.t)(),{mutateAsync:t}=(0,f.YH)(),a=(0,i.useRef)(null),r=(0,i.useRef)(null),getCoins=async()=>{let t=await e.getAllCoins({owner:null==n?void 0:n.address}),s=t.data.reduce((e,n)=>{var t;let s=n.coinType;return e.has(s)||e.set(s,[]),null===(t=e.get(s))||void 0===t||t.push(n),e},new Map);return s};(0,i.useEffect)(()=>{if(n&&(null==n?void 0:n.address)){var e;null===(e=a.current)||void 0===e||e.setValue("to",n.address),getCoins().then(e=>{var n;let t=Array.from(e.keys()).map(n=>({label:n,value:n,extra:e.get(n)}));null===(n=r.current)||void 0===n||n.setOptions(t)})}},[n]);let handleTransfer=async()=>{var s,i,l,o,c,u;let p=null==n?void 0:n.address,f=null===(s=r.current)||void 0===s?void 0:s.getCurrentOption(),g=null===(i=a.current)||void 0===i?void 0:i.getValue("to"),v=null===(l=a.current)||void 0===l?void 0:l.getValue("amount"),w=null===(o=a.current)||void 0===o?void 0:o.getValue("assetDecimals"),y=null==f?void 0:f.value,h=(await e.getCoins({owner:p,coinType:y,limit:100})).data,x=new m.Y,b=new j.Z(v).shiftedBy(w),S=b.toString();console.log("amountBNString",S);let T=h.reduce((e,n)=>e.plus(new j.Z(n.balance)),new j.Z(0));if(T.lt(b))throw null===(u=a.current)||void 0===u||u.setValue("result","余额不足"),Error("Insufficient balance");let[O,...C]=null==h?void 0:h.filter(e=>normalizeSuiCoinType(e.coinType)===normalizeSuiCoinType(y));if((null==f?void 0:f.value)===d.uq){let e=x.splitCoins(x.gas,[S]);x.transferObjects([e],g)}else{let e=x.object(O.coinObjectId);C.length&&x.mergeCoins(e,C.map(e=>x.object(e.coinObjectId)));let n=x.splitCoins(e,[S]);x.transferObjects([n],g),x.setSender(p)}let N=await t({transaction:x,account:n});null===(c=a.current)||void 0===c||c.setValue("result",JSON.stringify(N))};return(0,s.jsxs)(b.s,{title:"测试 Native & Token 转账",description:"测试转账",ref:a,children:[(0,s.jsx)(b.s.Combobox,{id:"asset",label:"选择资产",placeholder:"请选择资产",required:!0,ref:r}),(0,s.jsx)(b.s.Text,{id:"assetInfo",type:"info"}),(0,s.jsx)(b.s.Text,{id:"assetDecimals",type:"info",hidden:!0}),(0,s.jsx)(AssetInfoView,{viewRef:a.current,client:e}),(0,s.jsx)(b.s.Field,{id:"to",label:"to",placeholder:"请输入转账地址"}),(0,s.jsx)(b.s.Field,{id:"amount",label:"转账金额",defaultValue:"0.0001"}),(0,s.jsx)(b.s.Button,{id:"transfer",label:"transfer",onClick:handleTransfer,availableDependencyFields:[{fieldIds:["asset","to","amount"]}]}),(0,s.jsx)(b.s.AutoHeightTextArea,{id:"result"})]})}function Example(){var e,n,t,u,d,p;let w=(0,f.nf)(),{setProvider:y}=(0,l.O)();(0,f.xe)(),(0,f.Or)();let b=(0,f.t)(),{currentWallet:j,connectionStatus:S,isConnected:T}=(0,f.BN)(),{mutateAsync:C}=(0,f.Or)(),{mutateAsync:N}=(0,f.ZZ)(),{mutateAsync:A}=(0,f.YH)(),{mutateAsync:M}=(0,f.LV)(),{mutateAsync:k}=function(){let{mutationKey:e,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{currentWallet:t}=(0,f.BN)(),s=(0,f.t)();return(0,h.D)({mutationKey:["wallet","sign-message"],mutationFn:async e=>{var n;if(!t)throw Error("No wallet is connected.");let a=null!==(n=e.account)&&void 0!==n?n:s;if(!a)throw Error("No wallet account is selected to sign the personal message with.");let i=t.features["sui:signMessage"];if(i){console.warn("This wallet doesn't support the `signPersonalMessage` feature... falling back to `signMessage`.");let{messageBytes:n,signature:t}=await i.signMessage({...e,account:a});return{bytes:n,signature:t}}throw Error("This wallet doesn't support the `signPersonalMessage` feature.")},...n})}(),{mutateAsync:E}=(0,f.b3)();(0,i.useEffect)(()=>{T&&b?y(!0):y(!1)},[T,b,y]);let I=(0,i.useMemo)(()=>{var e;return c.signTransaction(null!==(e=null==b?void 0:b.address)&&void 0!==e?e:"")},[null==b?void 0:b.address]),J=(0,i.useMemo)(()=>{var e;return c.signTokenTransaction(null!==(e=null==b?void 0:b.address)&&void 0!==e?e:"")},[null==b?void 0:b.address]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(g.Z,{title:"Base Info",children:[b&&(0,s.jsxs)("p",{children:["Account:",null!==(e=null==b?void 0:b.address)&&void 0!==e?e:""]}),b&&(0,s.jsxs)("p",{children:["PubKey:",null!==(n=null==b?void 0:b.publicKey)&&void 0!==n?n:""]}),b&&(0,s.jsxs)("p",{children:["ChainId:",null!==(t=null==b?void 0:b.chains)&&void 0!==t?t:""]}),j&&(0,s.jsxs)("p",{children:["Wallet Name:",null!==(u=null==j?void 0:j.name)&&void 0!==u?u:""]}),j&&(0,s.jsxs)("p",{children:["Wallet api version:",null!==(d=null==j?void 0:j.version)&&void 0!==d?d:""]}),j&&(0,s.jsxs)("p",{children:["Wallet Support Chains :",JSON.stringify(null!==(p=null==j?void 0:j.chains)&&void 0!==p?p:"")]}),j&&(0,s.jsxs)("p",{children:["Wallet Icon: ",(0,s.jsx)("img",{src:null==j?void 0:j.icon})]}),S&&(0,s.jsxs)("p",{children:["Status :",S]})]}),(0,s.jsx)(x.s,{title:"SignMessage",children:(0,s.jsx)(x.u,{title:"signPersonalMessage",description:"签名消息（SDK 验证依赖网络可能会失败，可以刷新网页重试 或 稍后重试，问题上下文 https://github.com/MystenLabs/sui/issues/17912#issuecomment-2166621747）",presupposeParams:c.signPersonalMessage,onExecute:async e=>{let n=await M({message:(0,r.nr)(e),account:b});return JSON.stringify(n)},onValidate:async(e,n)=>{let{bytes:t,signature:s}=JSON.parse(n),a=await (0,v.q7)(O.from(t,"base64"),s);return(b.address===a.toSuiAddress()).toString()}})}),(0,s.jsxs)(x.s,{title:"Transaction",children:[(0,s.jsx)(x.u,{title:"signTransactionBlock",description:"签名交易",presupposeParams:I,onExecute:async e=>{let{from:n,to:t,amount:s}=JSON.parse(e),a=new m.Y,[i]=a.splitCoins(a.gas,[s]);a.transferObjects([i],t);let r=await sponsorTransaction(w,n,await a.build({client:w,onlyTransactionKind:!0})),l=await N({transaction:r,account:b});return JSON.stringify(l)},onValidate:async(e,n)=>{let{transactionBlockBytes:t,signature:s}=JSON.parse(n),a=await (0,v.gA)(O.from(t,"base64"),s);return(b.address===a.toSuiAddress()).toString()}}),(0,s.jsx)(x.u,{title:"signAndExecuteTransactionBlock",description:"签名并执行交易",presupposeParams:I,onExecute:async e=>{let{from:n,to:t,amount:s}=JSON.parse(e),a=new m.Y;a.setSender(n);let[i]=a.splitCoins(a.gas,[s]);a.transferObjects([i],t);let r=await sponsorTransaction(w,n,await a.build({client:w,onlyTransactionKind:!0})),l=await A({transaction:r,account:b});return JSON.stringify(l)}}),(0,s.jsx)(x.u,{title:"signTransactionBlock",description:"签名交易 (特殊情况，带 clock、system 参数)",presupposeParams:I,onExecute:async e=>{let{from:n,to:t,amount:s}=JSON.parse(e),a=new m.Y,[i]=a.splitCoins(a.gas,[s]);a.transferObjects([i],t);let r=await sponsorTransaction(w,n,await a.build({client:w,onlyTransactionKind:!0}));r.system=()=>"0x5",r.clock=()=>"0x6",r.random=()=>"0x8",r.denyList=()=>"0x403";let l=await N({transaction:r,account:b});return JSON.stringify(l)},onValidate:async(e,n)=>{let{transactionBlockBytes:t,signature:s}=JSON.parse(n),a=await (0,v.gA)(O.from(t,"base64"),s);return(b.address===a.toSuiAddress()).toString()}}),(0,s.jsx)(x.u,{title:"signTransactionBlock (USDC)",description:"USDC代币转账签名",presupposeParams:J,onExecute:async e=>{let{from:n,to:t,amount:s,token:a}=JSON.parse(e),i=new m.Y;i.setSender(n);let{data:r}=await w.getCoins({owner:n,coinType:a});if(!r.length)throw Error("No BUSD coins found");let[l]=i.splitCoins(i.object(r[0].coinObjectId),[s]);i.transferObjects([l],t);let o=await sponsorTransaction(w,n,await i.build({client:w,onlyTransactionKind:!0})),c=await N({transaction:o,account:b});return JSON.stringify(c)},onValidate:async(e,n)=>{let{transactionBlockBytes:t,signature:s}=JSON.parse(n),a=await (0,v.gA)(O.from(t,"base64"),s);return((0,r.ci)(new Uint8Array(b.publicKey))===(0,r.ci)(a.toRawBytes())).toString()}}),(0,s.jsx)(x.u,{title:"signAndExecuteTransactionBlock (USDC)",description:"USDC代币转账签名并执行",presupposeParams:J,onExecute:async e=>{let{from:n,to:t,amount:s,token:a}=JSON.parse(e),i=new m.Y;i.setSender(n);let{data:r}=await w.getCoins({owner:n,coinType:a});if(!r.length)throw Error("No BUSD coins found");let[l]=i.splitCoins(i.object(r[0].coinObjectId),[s]);i.transferObjects([l],t);let o=await sponsorTransaction(w,n,await i.build({client:w,onlyTransactionKind:!0})),c=await A({transaction:o,account:b});return JSON.stringify(c)}})]}),(0,s.jsx)(x.s,{title:"业务测试",children:(0,s.jsx)(TransferForm,{})}),(0,s.jsx)(o.Z,{dapps:a})]})}let C=new w.S,{networkConfig:N}=(0,f.mB)({testnet:{url:(0,u.I)("testnet")},mainnet:{url:(0,u.I)("mainnet")}});function App(){let[e,n]=(0,i.useState)("mainnet");return(0,s.jsx)(y.aH,{client:C,children:(0,s.jsx)(f.MS,{networks:N,network:e,onNetworkChange:e=>{n(e)},children:(0,s.jsxs)(f.nS,{enableUnsafeBurner:!0,autoConnect:!0,children:[(0,s.jsx)(f.NL,{}),(0,s.jsx)(Example,{})]})})})}}}]);
//# sourceMappingURL=4395.2628cebbdb3ae8df.js.map