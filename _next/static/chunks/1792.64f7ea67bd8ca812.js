(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1792],{6793:function(e,t,n){"use strict";var a=n(85893);n(67294);var s=n(41664),r=n.n(s),i=n(51731);t.Z=e=>{let{dapps:t}=e;return(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.ll,{className:"text-xl",children:"Dapp Bookmarks"}),(0,a.jsx)(i.aY,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:t.map((e,t)=>(0,a.jsx)("div",{className:"border p-2 rounded-lg shadow-sm hover:shadow-md",children:(0,a.jsx)(r(),{href:e.url,legacyBehavior:!0,children:(0,a.jsxs)("a",{className:"text-blue-500 hover:underline text-lg block",children:[e.name," →"]})})},t))})]})}},80583:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return StellarExample}});var a=n(85893);let s=[{name:"Aqua Swap",url:"https://aqua.network/swap"},{name:"SoroSwap",url:"http://app.soroswap.finance/"}];var r=n(6912),i=n(67294),l=n(26815),o=n(99710),c=n(23225),u=n(6793);let d="Hello, Stellar!",g="GBNRYB34IYJ2MM44ADABDJPEVF6YYQM4PGWWMCXI3JFVYVEFRHAO7BSX",p={buildPayment:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"buildPayment",name:"Build Payment Transaction",value:JSON.stringify({sourceAddress:e,destinationAddress:g,amount:"10",memo:"Test Payment"},null,2)}]},buildTrust:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"buildTrust",name:"Build Trust Asset Transaction",value:JSON.stringify({sourceAddress:e,assetCode:"USDC",assetIssuer:"GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN",limit:"1000000"},null,2)}]},buildCreateAccount:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"buildCreateAccount",name:"Build Create Account Transaction",value:JSON.stringify({sourceAddress:e,destinationAddress:g,startingBalance:"2"},null,2)}]},signMessage:[{id:"signMessage",name:"Sign Message",value:JSON.stringify({message:d},null,2)}],signMessageFull:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"signMessageFull",name:"Sign Message (With Address)",value:JSON.stringify({message:d,address:e},null,2)}]},signAuthEntryMock:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"signAuthEntryMock",name:"Sign Auth Entry (Mock)",value:JSON.stringify({sourceAddress:e},null,2)}]},signAuthEntryReal:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"signAuthEntryReal",name:"Query Token Balance (Real RPC)",value:JSON.stringify({sourceAddress:e,operation:"balance"},null,2)}]},signAuthEntryTransfer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{id:"signAuthEntryTransfer",name:"Transfer Token (Real RPC)",value:JSON.stringify({sourceAddress:e,destinationAddress:g,amount:"1000000",operation:"transfer"},null,2)}]}};var f=n(96544),h=n(44172),m=n(58757);let y="https://mainnet.sorobanrpc.com";function getNativeContractId(e){let t=m.Asset.native();return t.contractId(e)}async function buildRealAuthEntry(e){var t,n,a;let{sourceAddress:s,networkPassphrase:r}=e,i=new m.SorobanRpc.Server(y);m.Keypair.fromPublicKey(s);let l=await i.getAccount(s),o=getNativeContractId(r),c=new m.Contract(o),u=c.call("balance",m.nativeToScVal(s,{type:"address"})),d=new m.TransactionBuilder(l,{fee:m.BASE_FEE,networkPassphrase:r}).addOperation(u).setTimeout(180).build(),g=await i.simulateTransaction(d);if(m.SorobanRpc.Api.isSimulationError(g))throw Error("Simulation failed: ".concat(g.error));let p=[];return(null===(t=g.result)||void 0===t?void 0:t.auth)&&p.push(...g.result.auth.map(e=>e.toXDR("base64"))),{authEntries:p,transactionXdr:d.toXDR(),simulationResult:{cost:g.cost,latestLedger:g.latestLedger,minResourceFee:g.minResourceFee,resultCount:(null===(a=g.result)||void 0===a?void 0:null===(n=a.auth)||void 0===n?void 0:n.length)||0}}}async function buildTokenTransferAuthEntry(e){var t,n,a;let{sourceAddress:s,destinationAddress:r,amount:i,networkPassphrase:l}=e,o=new m.SorobanRpc.Server(y);m.Keypair.fromPublicKey(s);let c=await o.getAccount(s),u=getNativeContractId(l),d=new m.Contract(u),g=d.call("transfer",m.nativeToScVal(s,{type:"address"}),m.nativeToScVal(r,{type:"address"}),m.nativeToScVal(BigInt(i),{type:"i128"})),p=new m.TransactionBuilder(c,{fee:m.BASE_FEE,networkPassphrase:l}).addOperation(g).setTimeout(180).build(),f=await o.simulateTransaction(p);if(m.SorobanRpc.Api.isSimulationError(f))throw Error("Simulation failed: ".concat(f.error));let h=[];return(null===(t=f.result)||void 0===t?void 0:t.auth)&&h.push(...f.result.auth.map(e=>e.toXDR("base64"))),{authEntries:h,transactionXdr:p.toXDR(),simulationResult:{cost:f.cost,latestLedger:f.latestLedger,minResourceFee:f.minResourceFee,resultCount:(null===(a=f.result)||void 0===a?void 0:null===(n=a.auth)||void 0===n?void 0:n.length)||0}}}let w=m.Networks.PUBLIC;async function checkAccountExists(e){let t=new m.SorobanRpc.Server(y);try{return await t.getAccount(e),!0}catch(e){return!1}}let x={network:"mainnet",networkPassphrase:"Public Global Stellar Network ; September 2015"},isHanaWallet=e=>!e.getAddress&&!!e.getPublicKey,signTransactionCompat=async(e,t,n)=>{if(!isHanaWallet(e))return await e.signTransaction(t,{networkPassphrase:n});{let a=await e.signTransaction({xdr:t,networkPassphrase:n});return{signedTxXdr:a}}},signMessageCompat=async(e,t,n)=>{if(!isHanaWallet(e))return await e.signMessage(t,n);{let a=await e.signMessage({message:t,accountToSign:null==n?void 0:n.address});return{signedMessage:a}}},signAuthEntryCompat=async(e,t,n)=>{if(!isHanaWallet(e))return await e.signAuthEntry(t,n);{let a=await e.signAuthEntry({xdr:t,accountToSign:null==n?void 0:n.address});return{signedAuthEntry:a}}};function StellarExample(){let e=(0,i.useRef)([{uuid:"injected-onekey",name:"Injected OneKey",inject:"$onekey.stellar"},{uuid:"injected-hana",name:"Injected hanaWallet",inject:"hanaWallet.stellar"}]),{provider:t,setAccount:n,account:d}=(0,c.O)(),g=(0,i.useRef)(x),onConnectWallet=async t=>{var n;let a;let s=null===(n=e.current)||void 0===n?void 0:n.find(e=>e.uuid===t.id);if(!s)return Promise.reject("Wallet not found");let r=(0,l.Z)(window,s.inject);if(!r){(0,f.Am)({title:"Wallet not found",description:"Please install the wallet extension"});return}if(r.getAddress){let e=await r.getAddress();a=e.address}else if(r.getPublicKey)a=await r.getPublicKey();else throw Error("Wallet does not support getAddress or getPublicKey");let i=x;try{r.getNetwork&&(i=await r.getNetwork())}catch(e){console.warn("Failed to get network, using default mainnet:",e)}return g.current=i,{provider:r,address:a}},onDisconnectWallet=async()=>{await (null==t?void 0:t.disconnect())};return(0,i.useEffect)(()=>{if(!t)return;let onAccountsChangedListener=e=>{e?(console.log("stellar [accountsChanged] Switched account to ".concat(e)),n({...d,address:e})):console.log("stellar [accountsChanged] Account disconnected")},onDisconnectListener=()=>{console.log("stellar [disconnect] \uD83D\uDC4B")};return t.on("accountsChanged",onAccountsChangedListener),t.on("disconnect",onDisconnectListener),()=>{t.removeListener("accountsChanged",onAccountsChangedListener),t.removeListener("disconnect",onDisconnectListener)}},[d,t,n]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{fetchWallets:()=>Promise.resolve(e.current.map(e=>({id:e.uuid,name:e.name}))),onConnect:onConnectWallet,onDisconnect:onDisconnectWallet}),(0,a.jsxs)(o.s,{title:"Basics",children:[(0,a.jsx)(o.u,{title:"getAddress / getPublicKey",description:"获取钱包地址（兼容 OneKey 和 Hana Wallet）",disableRequestContent:!0,onExecute:async()=>{if(null==t?void 0:t.getAddress){let e=await t.getAddress();return JSON.stringify(e,null,2)}if(null==t?void 0:t.getPublicKey){let e=await t.getPublicKey();return JSON.stringify({address:e},null,2)}throw Error("Wallet does not support getAddress or getPublicKey")}}),(0,a.jsx)(o.u,{title:"getNetwork",description:"获取并更新当前网络信息（主网/测试网）",disableRequestContent:!0,onExecute:async()=>{let e=x;try{(null==t?void 0:t.getNetwork)&&(e=await t.getNetwork())}catch(e){console.warn("Failed to get network, using default mainnet:",e)}return g.current=e,JSON.stringify({...e,tip:"网络信息已更新，后续签名将使用此 networkPassphrase"},null,2)}}),(0,a.jsx)(o.u,{title:"disconnect",description:"断开钱包连接",disableRequestContent:!0,onExecute:async()=>(await (null==t?void 0:t.disconnect()),g.current=x,"Disconnected successfully")})]}),(0,a.jsxs)(o.s,{title:"Build & Sign Transactions",children:[(0,a.jsx)(o.u,{title:"Payment Transaction",description:"构建并签名支付交易",presupposeParams:p.buildPayment((null==d?void 0:d.address)||""),onExecute:async e=>{let{sourceAddress:n,destinationAddress:a,amount:s,memo:r}=JSON.parse(e),i=function(e){let{sourceAddress:t,destinationAddress:n,amount:a,networkPassphrase:s,memo:r}=e,i=h.Keypair.fromPublicKey(t),l=new h.Account(i.publicKey(),"0"),o=new h.TransactionBuilder(l,{fee:h.BASE_FEE,networkPassphrase:s});o.addOperation(h.Operation.payment({destination:n,asset:h.Asset.native(),amount:a})),r&&o.addMemo(h.Memo.text(r)),o.setTimeout(180);let c=o.build();return c.toXDR()}({sourceAddress:n||(null==d?void 0:d.address)||"",destinationAddress:a,amount:s,memo:r,networkPassphrase:g.current.networkPassphrase}),l=await signTransactionCompat(t,i,g.current.networkPassphrase);return JSON.stringify({...l,xdr:"".concat(i.substring(0,100),"...")},null,2)}}),(0,a.jsx)(o.u,{title:"Trust Asset Transaction",description:"构建并签名信任资产交易（添加自定义资产）",presupposeParams:p.buildTrust((null==d?void 0:d.address)||""),onExecute:async e=>{let{sourceAddress:n,assetCode:a,assetIssuer:s,limit:r}=JSON.parse(e),i=function(e){let{sourceAddress:t,assetCode:n,assetIssuer:a,networkPassphrase:s,limit:r}=e,i=h.Keypair.fromPublicKey(t),l=new h.Account(i.publicKey(),"0"),o=new h.Asset(n,a),c=new h.TransactionBuilder(l,{fee:h.BASE_FEE,networkPassphrase:s});c.addOperation(h.Operation.changeTrust({asset:o,limit:r})),c.setTimeout(180);let u=c.build();return u.toXDR()}({sourceAddress:n||(null==d?void 0:d.address)||"",assetCode:a,assetIssuer:s,limit:r,networkPassphrase:g.current.networkPassphrase}),l=await signTransactionCompat(t,i,g.current.networkPassphrase);return JSON.stringify({...l,xdr:"".concat(i.substring(0,100),"...")},null,2)}}),(0,a.jsx)(o.u,{title:"Create Account Transaction",description:"构建并签名创建账户交易",presupposeParams:p.buildCreateAccount((null==d?void 0:d.address)||""),onExecute:async e=>{let{sourceAddress:n,destinationAddress:a,startingBalance:s}=JSON.parse(e),r=function(e){let{sourceAddress:t,destinationAddress:n,startingBalance:a,networkPassphrase:s}=e,r=h.Keypair.fromPublicKey(t),i=new h.Account(r.publicKey(),"0"),l=new h.TransactionBuilder(i,{fee:h.BASE_FEE,networkPassphrase:s});l.addOperation(h.Operation.createAccount({destination:n,startingBalance:a})),l.setTimeout(180);let o=l.build();return o.toXDR()}({sourceAddress:n||(null==d?void 0:d.address)||"",destinationAddress:a,startingBalance:s,networkPassphrase:g.current.networkPassphrase}),i=await signTransactionCompat(t,r,g.current.networkPassphrase);return JSON.stringify({...i,xdr:"".concat(r.substring(0,100),"...")},null,2)}})]}),(0,a.jsx)(o.s,{title:"Sign Message",children:(0,a.jsx)(o.u,{title:"signMessage",description:"签名消息, 参考: https://docs.freighter.app/docs/playground/signmessage/",presupposeParams:p.signMessage,onExecute:async e=>{let{message:n}=JSON.parse(e),a=await signMessageCompat(t,n);return JSON.stringify(a,null,2)}})}),(0,a.jsxs)(o.s,{title:"Soroban (Smart Contracts)",children:[(0,a.jsx)(o.u,{title:"signAuthEntry (Real - Balance Query)",description:"真实的授权签名 - 通过RPC模拟获取（查询余额）",presupposeParams:p.signAuthEntryReal((null==d?void 0:d.address)||""),onExecute:async e=>{let{sourceAddress:n}=JSON.parse(e),a=n||(null==d?void 0:d.address)||"",s=await checkAccountExists(a);if(!s)throw Error("账户 ".concat(a," 在主网上不存在或未激活。"));let{authEntries:r,simulationResult:i}=await buildRealAuthEntry({sourceAddress:a,networkPassphrase:w});if(0===r.length)return JSON.stringify({note:"此操作不需要授权签名（balance查询是公开的）",simulation:i},null,2);let l=r[0],o=await signAuthEntryCompat(t,l,{networkPassphrase:w});return JSON.stringify({...o,authEntryPreview:"".concat(l.substring(0,100),"..."),simulation:i,note:"这是通过 Stellar Mainnet RPC 真实模拟得到的授权条目"},null,2)}}),(0,a.jsx)(o.u,{title:"signAuthEntry (Real - Token Transfer)",description:"真实的授权签名 - 通过RPC模拟获取（代币转账）",presupposeParams:p.signAuthEntryTransfer((null==d?void 0:d.address)||""),onExecute:async e=>{let{sourceAddress:n,destinationAddress:a,amount:s}=JSON.parse(e),r=n||(null==d?void 0:d.address)||"",i=await checkAccountExists(r);if(!i)throw Error("账户 ".concat(r," 在主网上不存在或未激活。"));let{authEntries:l,simulationResult:o}=await buildTokenTransferAuthEntry({sourceAddress:r,destinationAddress:a,amount:s,networkPassphrase:w});if(0===l.length)throw Error("模拟未返回授权条目，可能是合约调用参数错误");let c=[];for(let e of l){console.log("authEntry",e);let n=await signAuthEntryCompat(t,e,{networkPassphrase:w});c.push(n)}return JSON.stringify({signedAuthEntries:c,authEntriesCount:l.length,authEntryPreview:"".concat(l[0].substring(0,100),"..."),simulation:o,note:"这是通过 Stellar Mainnet RPC 真实模拟得到的授权条目（转账操作需要授权）"},null,2)}})]}),(0,a.jsx)(u.Z,{dapps:s})]})}},6912:function(e,t,n){"use strict";n.d(t,{Z:function(){return ConnectButton}});var a=n(85893),s=n(67294),r=n(9663),i=n(51731),l=n(53617),o=n(23225),c=n(96544),u=n(27361),d=n.n(u),g=n(78299);let p={address:"地址",publicKey:"公钥",chainId:"网络"};function ConnectButton(e){let{fetchWallets:t,onConnect:n,onDisconnect:u}=e,{settings:f}=(0,g.r)(),h=(0,s.useRef)(null),m=(0,s.useRef)(!1),[y,w]=(0,s.useState)([]),{setProvider:x,setAccount:v,provider:A,account:b}=(0,o.O)(),E=(0,s.useCallback)(async e=>{try{let{provider:t,...a}=await n(e);x(t),v(a)}catch(e){console.log("connectWallet error",e),(0,c.Am)({title:"连接失败",description:d()(e,"message","")})}},[n,v,x]),C=(0,s.useCallback)(async()=>{m.current=!1,await (null==u?void 0:u()),x(null),v(null)},[u,v,x]),N=(0,s.useCallback)(()=>{setTimeout(()=>{try{var e;null===(e=h.current)||void 0===e||e.click()}catch(e){}},150)},[]),S=(0,s.useCallback)(async e=>{let n=await (null==t?void 0:t());if((null==n?void 0:n.length)===0){N();return}let{directConnection:a}=null!=e?e:{directConnection:!1};(null==n?void 0:n.length)===1||(null==n?void 0:n.length)>0&&a?(N(),await E(n[0])):w(n)},[N,E,t]);return(0,s.useEffect)(()=>{let e=setTimeout(async()=>{!m.current&&(console.log("settings.autoConnect",f.autoConnect),f.autoConnect&&(m.current=!0,await S({directConnection:!0})))},500);return()=>{clearTimeout(e)}},[f.autoConnect]),(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"flex flex-col flex-wrap gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-row flex-wrap justify-between",children:[(0,a.jsxs)(l.Vq,{children:[(0,a.jsx)(l.hg,{asChild:!0,children:(0,a.jsx)(r.z,{onClick:()=>S(),children:"Connect Wallet"})}),(0,a.jsxs)(l.cZ,{children:[(0,a.jsx)(l.GG,{ref:h}),(0,a.jsxs)(l.fK,{children:[(0,a.jsx)(l.$N,{children:"选择钱包开始连接"}),!!y&&y.map(e=>{var t;return(0,a.jsx)(l.GG,{asChild:!0,children:(0,a.jsxs)(r.z,{onClick:()=>E(e),className:"gap-2",children:[e.logo&&(0,a.jsx)("img",{alt:e.name,src:e.logo,className:"w-5 h-5 rounded-full"}),(0,a.jsx)("span",{className:"font-medium",children:e.name}),null===(t=e.tags)||void 0===t?void 0:t.map(e=>(0,a.jsx)("span",{className:"text-xs font-light",children:e},e))]})},e.id)}),!y||0===y.length&&(0,a.jsxs)(l.Be,{children:["没有钱包可用，请安装 OneKey Extension",(0,a.jsx)("a",{target:"_blank",href:"https://www.onekey.so/download/",children:"Install OneKey Extension →"})]})]})]})]}),A&&(0,a.jsx)(r.z,{variant:"destructive",onClick:C,children:"断开链接"})]}),b&&(0,a.jsx)("div",{className:"flex grid-cols-1 xl:grid-cols-2 flex-wrap gap-x-6 gap-y-3 mt-4",children:Object.keys(b).map(e=>{var t;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["".concat(null!==(t=null==p?void 0:p[e])&&void 0!==t?t:e),": "]}),(0,a.jsx)("span",{className:"font-normal flex flex-wrap text-break",children:"".concat(null==b?void 0:b[e])})]},e)})})]})})}},53617:function(e,t,n){"use strict";n.d(t,{$N:function(){return f},Be:function(){return h},GG:function(){return d},Vq:function(){return o},cZ:function(){return p},fK:function(){return DialogHeader},hg:function(){return c}});var a=n(85893),s=n(67294),r=n(12854),i=n(41352),l=n(13441);let o=r.fC,c=r.xz,u=r.h_,d=r.x8,g=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...s})});g.displayName=r.aV.displayName;let p=s.forwardRef((e,t)=>{let{className:n,children:s,...o}=e;return(0,a.jsxs)(u,{children:[(0,a.jsx)(g,{}),(0,a.jsxs)(r.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[35%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...o,children:[s,(0,a.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});p.displayName=r.VY.displayName;let DialogHeader=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};DialogHeader.displayName="DialogHeader";let f=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",n),...s})});f.displayName=r.Dx.displayName;let h=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(r.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",n),...s})});h.displayName=r.dk.displayName},54142:function(){}}]);
//# sourceMappingURL=1792.64f7ea67bd8ca812.js.map