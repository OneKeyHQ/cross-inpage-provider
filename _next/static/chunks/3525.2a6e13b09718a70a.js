"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3525],{50615:function(e,t,n){n.d(t,{Z:function(){return InfoLayout}});var s=n(85893),a=n(51731);function InfoLayout(e){let{title:t,children:n}=e;return(0,s.jsxs)(a.Zb,{children:[t&&(0,s.jsx)(a.Ol,{className:"font-medium",children:t}),(0,s.jsx)(a.aY,{className:"flex flex-col flex-wrap gap-3 break-all",children:n})]})}},63525:function(e,t,n){n.r(t),n.d(t,{default:function(){return App}});var s=n(85893);let a=[{name:"Bluefin",url:"https://trade.bluefin.io/"},{name:"Cetus",url:"https://app.cetus.zone/"},{name:"SuiSwap",url:"https://suiswap.app/"},{name:"Sui Names",url:"https://sui-names.com/"}];var i=n(67294),l=n(6912),o=n(66409),r=n(23225),c=n(6793),u=n(34105),d={signMessage:[{id:"signMessage hello",name:"signData Hello",value:"48656c6c6f204f6e654b6579"},{id:"signMessage",name:"signMessage",value:"010203"}],signPersonalMessage:[{id:"signPersonalMessage hello",name:"signPersonalMessage Hello",value:"48656c6c6f204f6e654b6579"},{id:"signPersonalMessage",name:"signPersonalMessage",value:"010203"}],signTransaction:e=>[{id:"signTransaction",name:"signTransaction",value:JSON.stringify({from:e,to:e,amount:1e5})}],signTokenTransaction:e=>[{id:"signUSDTransaction-BFC-gas",name:"BUSD_TYPE use BFC gas",value:JSON.stringify({busdGas:!1,from:e,to:e,amount:1e3,token:"0x00000000000000000000000000000000000000000000000000000000000000c8::busd::BUSD"})},{id:"signUSDTransaction-BUSD-gas",name:"BUSD_TYPE use busdGas",value:JSON.stringify({busdGas:!0,from:e,to:e,amount:1e3,token:"0x00000000000000000000000000000000000000000000000000000000000000c8::busd::BUSD"})}]},p=n(56787),g=n(2712),m=n(39922),f=n(28645),B=n(96126),w=n(84984),x=n(36374),b=n(51853),j=n(42348),v=n(78921),y=n(18177),h=n(43580),S=n(30653),C=n(50615),O=n(60452),I=n(66114),T=n(8590),k=n(30202),N=n(98029),U=n(99710),D=n(29269),F=n(75955);let normalizeStructTagForRpc=e=>{let t=(0,D.$A)(e);return t.address=(0,F.Og)(t.address),(0,D.kX)(t)};async function sponsorTransaction(e,t,n){let s=[],a=await e.getCoins({owner:t,limit:1});a.data.length>0&&(s=a.data.map(e=>({objectId:e.coinObjectId,version:e.version,digest:e.digest})));let i=O.a6.fromKind(n);return i.setSender(t),i.setGasOwner(t),i.setGasPayment(s),i}let A={BFC:{address:"BFC000000000000000000000000000000000000000000000000000000000000000268e4::bfc::BFC",decimals:9,symbol:"BFC",logoURI:"https://obstatic.243096.com/mili/images/currency/chain/Benfen2.png"},BUSD:{address:"BFC00000000000000000000000000000000000000000000000000000000000000c8e30a::busd::BUSD",decimals:9,symbol:"BUSD",logoURI:"https://obstatic.243096.com/download/token/images/BenfenTEST/BFC00000000000000000000000000000000000000000000000000000000000000c8e30a::busd::BUSD.png"}},computeTxBudget=async function(e,t,n,s){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:BigInt(0),i=BigInt(5e10),l=O.Q6*O.l2;if(n.address===A.BFC.address){let n=t-a;e.setGasBudget(n<i?n:i)}else{let o=BigInt(await s.getStableRate(normalizeStructTagForRpc(n.address))),r=i*u.nf/o*BigInt(9)/BigInt(10);l=l*u.nf/o;let c=t-a;e.setGasBudget(c<r?c:r)}let o=await s.dryRunTransactionBlock({transactionBlock:await e.build({client:s})});if("success"!==o.effects.status.status)throw Error(o.effects.status.error||"Unknown error");let r=o.effects.gasUsed,c=BigInt(r.computationCost)+BigInt(r.storageCost)+l;e.setGasBudget(c<t?c:t)};var E=n(70794),P=n(25618),J=n(48764).Buffer;function Example(){let e=(0,g.U)(),{setProvider:t}=(0,r.O)(),[n,l]=(0,i.useState)(""),p=(0,m.t)(),{isConnected:b}=(0,f.B)(),{mutateAsync:j}=(0,B.R)(),{mutateAsync:v}=(0,w.O)({executeFromWallet:!0}),{mutateAsync:y}=(0,x.L)(),{mutateAsync:h}=function(){let{mutationKey:e,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{currentWallet:n}=(0,f.B)(),s=(0,m.t)();return(0,N.D)({mutationKey:["wallet","sign-message"],mutationFn:async e=>{var t;if(!n)throw Error("No wallet is connected.");let a=null!==(t=e.account)&&void 0!==t?t:s;if(!a)throw Error("No wallet account is selected to sign the personal message with.");let i=n.features["sui:signMessage"];if(i){console.warn("This wallet doesn't support the `signPersonalMessage` feature... falling back to `signMessage`.");let{messageBytes:t,signature:n}=await i.signMessage({...e,account:a});return{bytes:t,signature:n}}throw Error("This wallet doesn't support the `signPersonalMessage` feature.")},...t})}();console.log("currentAccount",p),(0,i.useEffect)(()=>{b&&p?t(!0):t(!1)},[b,p,t]);let S=(0,i.useMemo)(()=>{var e;return d.signTransaction(null!==(e=null==p?void 0:p.address)&&void 0!==e?e:"")},[null==p?void 0:p.address]),C=(0,i.useMemo)(()=>{var e;return d.signTokenTransaction(null!==(e=null==p?void 0:p.address)&&void 0!==e?e:"")},[null==p?void 0:p.address]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.s,{title:"SignMessage",children:(0,s.jsx)(U.u,{title:"signPersonalMessage",description:"签名消息（SDK 验证依赖网络可能失败，可以刷新网页重试 或 稍后重试，问题上下文 https://github.com/MystenLabs/sui/issues/17912#issuecomment-2166621747）",presupposeParams:d.signPersonalMessage,onExecute:async e=>{let t=await y({message:(0,o.nr)(e),account:p});return JSON.stringify(t)},onValidate:async(e,t)=>{let{bytes:n,signature:s}=JSON.parse(t),a=await (0,I.qz)(J.from(n,"base64"),s);return((0,o.ci)(new Uint8Array(null==p?void 0:p.publicKey))===(0,o.ci)(a.toRawBytes())).toString()}})}),(0,s.jsxs)(U.s,{title:"Transaction",children:[(0,s.jsx)(U.u,{title:"signTransactionBlock",description:"签名交易",presupposeParams:S,onExecute:async t=>{let{from:n,to:s,amount:a}=JSON.parse(t),i=new O.a6,[l]=i.splitCoins(i.gas,[i.pure(a)]);i.transferObjects([l],i.pure(s));let o=await sponsorTransaction(e,n,await i.build({client:e,onlyTransactionKind:!0})),r=await j({transactionBlock:o,account:p});return JSON.stringify(r)},onValidate:async(e,t)=>{let{transactionBlockBytes:n,signature:s}=JSON.parse(t),a=await (0,I.Em)(J.from(n,"base64"),s);return((0,o.ci)(new Uint8Array(null==p?void 0:p.publicKey))===(0,o.ci)(a.toRawBytes())).toString()}}),(0,s.jsx)(U.u,{title:"signAndExecuteTransactionBlock",description:"签名并执行交易",presupposeParams:S,onExecute:async t=>{let{from:s,to:a,amount:i}=JSON.parse(t),l=new O.a6;l.setSender(s);let[o]=l.splitCoins(l.gas,[l.pure(i)]);l.transferObjects([o],l.pure(n||a));let r=await sponsorTransaction(e,s,await l.build({client:e,onlyTransactionKind:!0})),c=await v({transactionBlock:r,account:p});return JSON.stringify(c)}}),(0,s.jsx)(U.u,{title:"signTransactionBlock",description:"签名交易 (特殊情况，带 clock、system 参数)",presupposeParams:S,onExecute:async t=>{let{from:n,to:s,amount:a}=JSON.parse(t),i=new O.a6,[l]=i.splitCoins(i.gas,[i.pure(a)]);i.transferObjects([l],i.pure(s));let o=await sponsorTransaction(e,n,await i.build({client:e,onlyTransactionKind:!0}));o.system=()=>"0x5",o.clock=()=>"0x6",o.random=()=>"0x8",o.denyList=()=>"0x403";let r=await j({transactionBlock:o,account:p});return JSON.stringify(r)},onValidate:async(e,t)=>{let{transactionBlockBytes:n,signature:s}=JSON.parse(t),a=await (0,I.Em)(J.from(n,"base64"),s);return((0,o.ci)(new Uint8Array(null==p?void 0:p.publicKey))===(0,o.ci)(a.toRawBytes())).toString()}}),(0,s.jsx)(U.u,{title:"signTransactionBlock (BUSD)",description:"BUSD代币转账签名",presupposeParams:C,onExecute:async t=>{let{from:n,to:s,amount:a,token:i}=JSON.parse(t),l=new O.a6;l.setSender(n);let{data:o}=await e.getCoins({owner:n,coinType:i});if(!o.length)throw Error("No BUSD coins found");let[r]=l.splitCoins(l.object(o[0].coinObjectId),[l.pure(a)]);l.transferObjects([r],l.pure(s));let c=await sponsorTransaction(e,n,await l.build({client:e,onlyTransactionKind:!0})),u=await j({transactionBlock:c,account:p});return JSON.stringify(u)},onValidate:async(e,t)=>{let{transactionBlockBytes:n,signature:s}=JSON.parse(t),a=await (0,I.Em)(J.from(n,"base64"),s);return((0,o.ci)(new Uint8Array(null==p?void 0:p.publicKey))===(0,o.ci)(a.toRawBytes())).toString()}}),(0,s.jsx)(U.u,{title:"signAndExecuteTransactionBlock (BUSD)",description:"BUSD代币转账签名并执行",presupposeParams:C,onExecute:async t=>{let n;let{from:s,to:a,amount:i,token:l,busdGas:o}=JSON.parse(t),r=new O.a6,c=BigInt(new E.Z(i).toFixed(0)),{data:u}=await e.getCoins({owner:s,coinType:A.BFC.address}),d=u;if(o){let{data:t}=await e.getCoins({owner:s,coinType:A.BUSD.address});d=t;let[a,...i]=u;i.length>0&&r.mergeCoins(r.object(a.coinObjectId),i.map(e=>r.object(e.coinObjectId))),n=r.splitCoins(r.object(a.coinObjectId),[r.pure(c)])}else if(l===A.BFC.address)n=r.splitCoins(r.gas,[r.pure(c)]);else{let{data:t}=await e.getCoins({owner:s,coinType:l}),[a,...i]=t;i.length>0&&r.mergeCoins(r.object(a.coinObjectId),i.map(e=>r.object(e.coinObjectId))),n=r.splitCoins(r.object(a.coinObjectId),[r.pure(c)])}r.setGasPayment(d.map(e=>({objectId:e.coinObjectId,version:e.version,digest:e.digest}))),r.transferObjects([n],r.pure(a)),r.setSenderIfNotSet(s),await computeTxBudget(r,d.reduce((e,t)=>BigInt(t.balance)+e,BigInt(0)),o?A.BUSD:A.BFC,e);let p=await v({transactionBlock:r});return JSON.stringify(p)}}),(0,s.jsxs)(P.s,{title:"Benfen Swap",description:"Benfen Swap 相关操作",children:[(0,s.jsx)(P.s.Text,{id:"swapButtonTitle",value:"测试 BFC 转 BUSD",size:"lg"}),(0,s.jsx)(P.s.Field,{type:"number",id:"swapBfcAmount",label:"BFC 数量",required:!0,defaultValue:"0.01"}),(0,s.jsx)(P.s.Checkbox,{id:"useBusdGasSwapBfc",label:"使用 BUSD 作为 gas"}),(0,s.jsx)(P.s.Button,{id:"swapButton",label:"BFC 转 BUSD",onClick:async t=>{var n,s,a;let i;let l=null!==(n=null==t?void 0:t.getValue("swapBfcAmount"))&&void 0!==n?n:"0",o=null==t?void 0:t.getValue("useBusdGasSwapBfc"),r=new O.a6;r.setSenderIfNotSet(null!==(s=null==p?void 0:p.address)&&void 0!==s?s:"");let c=BigInt(new E.Z(l).shiftedBy(u.Hc).toFixed(0)),d=null!==(a=null==p?void 0:p.address)&&void 0!==a?a:"",{data:g}=await e.getCoins({owner:d,coinType:A.BFC.address}),m=g;if(o){let{data:t}=await e.getCoins({owner:d,coinType:A.BUSD.address});m=t;let[n,...s]=g;s.length>0&&r.mergeCoins(r.object(n.coinObjectId),s.map(e=>r.object(e.coinObjectId))),i=r.splitCoins(r.object(n.coinObjectId),[r.pure(c)])}else i=r.splitCoins(r.gas,[r.pure(c)]);r.setGasPayment(m.map(e=>({objectId:e.coinObjectId,version:e.version,digest:e.digest}))),r.moveCall({target:"0xc8::bfc_system::swap_bfc_to_stablecoin",typeArguments:[A.BUSD.address],arguments:[r.object("0xc9"),i,r.object(u.tX),r.pure(c),r.pure("0"),r.pure(Date.now()+18e5)]}),r.setSenderIfNotSet(d),await computeTxBudget(r,m.reduce((e,t)=>BigInt(t.balance)+e,BigInt(0)),o?A.BUSD:A.BFC,e,c);let f=await v({transactionBlock:r});null==t||t.setValue("swapResponse",JSON.stringify(f,null,2))},validation:{fields:["swapBfcAmount"],validator:e=>{if(!e.swapBfcAmount)return"请输入 BFC 数量"}}}),(0,s.jsx)(P.s.Field,{type:"text",id:"swapResponse",label:"响应"}),(0,s.jsx)(P.s.Separator,{}),(0,s.jsx)(P.s.Field,{type:"number",id:"swapBusdAmount",label:"BUSD 数量",required:!0,defaultValue:"0.01"}),(0,s.jsx)(P.s.Checkbox,{id:"useBusdGasSwapBusd",label:"使用 BUSD 作为 gas"}),(0,s.jsx)(P.s.Button,{id:"swapBusdButton",label:"BUSD 转 BFC",onClick:async t=>{var n,s;let a;let i=null!==(n=null==t?void 0:t.getValue("swapBusdAmount"))&&void 0!==n?n:"0",l=null==t?void 0:t.getValue("useBusdGasSwapBusd"),o=new O.a6,r=null!==(s=null==p?void 0:p.address)&&void 0!==s?s:"";console.log("=====>>>>> busdGas",l);let c=BigInt(new E.Z(i).shiftedBy(u.Hc).toFixed(0)),{data:d}=await e.getCoins({owner:r,coinType:A.BUSD.address}),g=d;if(l)a=o.splitCoins(o.gas,[o.pure(c)]);else{let[t,...n]=d;n.length>0&&o.mergeCoins(o.object(t.coinObjectId),n.map(e=>o.object(e.coinObjectId))),a=o.splitCoins(o.object(t.coinObjectId),[o.pure(c)]);let{data:s}=await e.getCoins({owner:r,coinType:A.BFC.address});g=s}o.setGasPayment(g.map(e=>({objectId:e.coinObjectId,version:e.version,digest:e.digest}))),o.setSenderIfNotSet(r),o.moveCall({target:"0xc8::bfc_system::swap_stablecoin_to_bfc",typeArguments:[A.BUSD.address],arguments:[o.object("0xc9"),a,o.object(u.tX),o.pure(c),o.pure("0"),o.pure(Date.now()+18e5)]}),await computeTxBudget(o,g.reduce((e,t)=>BigInt(t.balance)+e,BigInt(0)),l?A.BUSD:A.BFC,e,c);let m=await v({transactionBlock:o});null==t||t.setValue("response",JSON.stringify(m,null,2))},validation:{fields:["swapBusdAmount"],validator:e=>{if(!e.swapBusdAmount)return"请输入 BFC 数量"}}}),(0,s.jsx)(P.s.Field,{type:"text",id:"response",label:"响应"})]})]}),(0,s.jsx)(c.Z,{dapps:a})]})}let G=new T.S,{networkConfig:M}=(0,b.m)({testnet:{url:(0,p.I)("testnet")},mainnet:{url:(0,p.I)("mainnet")}});function BenfenConnectButton(){var e,t,n,a,o,r,c;let u=(0,j.r)(),d=(0,m.t)(),{currentWallet:p,connectionStatus:g,isConnected:B}=(0,f.B)(),{mutateAsync:w}=(0,v.O)(),{mutateAsync:x}=(0,y.b)(),b=(0,i.useRef)([]);b.current=u,console.log("Benfen Standard Wallets:",b.current);let h=(0,i.useCallback)(async e=>{let t=b.current.find(t=>t.name===e.id);return t?(w({wallet:t,accountAddress:null==d?void 0:d.address}),{provider:void 0}):Promise.reject("Wallet not found")},[w,null==d?void 0:d.address]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{fetchWallets:()=>Promise.resolve(b.current.map(e=>({id:e.name,name:e.name}))),onConnect:h,onDisconnect:()=>void x()}),(0,s.jsxs)(C.Z,{title:"Base Info",children:[d&&(0,s.jsxs)("p",{children:["Account:",null!==(e=null==d?void 0:d.address)&&void 0!==e?e:""]}),d&&(0,s.jsxs)("p",{children:["PubKey:",null!==(t=null==d?void 0:d.publicKey)&&void 0!==t?t:""]}),d&&(0,s.jsxs)("p",{children:["ChainId:",null!==(n=null==d?void 0:d.chains)&&void 0!==n?n:""]}),p&&(0,s.jsxs)("p",{children:["Wallet Name:",null!==(a=null==p?void 0:p.name)&&void 0!==a?a:""]}),p&&(0,s.jsxs)("p",{children:["Wallet api version:",null!==(o=null==p?void 0:p.version)&&void 0!==o?o:""]}),p&&(0,s.jsxs)("p",{children:["Wallet Support Chains :",JSON.stringify(null!==(r=null==p?void 0:p.chains)&&void 0!==r?r:"")]}),p&&(0,s.jsxs)("p",{children:["Wallet Icon: ",(0,s.jsx)("img",{src:null==p?void 0:p.icon})]}),g&&(0,s.jsxs)("p",{children:["Status :",g]}),p&&(0,s.jsxs)("p",{children:["Wallet Support Features: ",JSON.stringify(null!==(c=null==p?void 0:p.features)&&void 0!==c?c:"",null,2)]})]})]})}function App(){let[e,t]=(0,i.useState)("mainnet");return(0,s.jsx)(k.aH,{client:G,children:(0,s.jsx)(h.r,{networks:M,network:e,onNetworkChange:e=>{t(e)},children:(0,s.jsxs)(S.n,{autoConnect:!0,children:[(0,s.jsx)(BenfenConnectButton,{}),(0,s.jsx)(Example,{})]})})})}},6912:function(e,t,n){n.d(t,{Z:function(){return ConnectButton}});var s=n(85893),a=n(67294),i=n(9663),l=n(51731),o=n(53617),r=n(23225),c=n(96544),u=n(27361),d=n.n(u),p=n(78299);let g={address:"地址",publicKey:"公钥",chainId:"网络"};function ConnectButton(e){let{fetchWallets:t,onConnect:n,onDisconnect:u}=e,{settings:m}=(0,p.r)(),f=(0,a.useRef)(null),B=(0,a.useRef)(!1),[w,x]=(0,a.useState)([]),{setProvider:b,setAccount:j,provider:v,account:y}=(0,r.O)(),h=(0,a.useCallback)(async e=>{try{let{provider:t,...s}=await n(e);b(t),j(s)}catch(e){console.log("connectWallet error",e),(0,c.Am)({title:"连接失败",description:d()(e,"message","")})}},[n,j,b]),S=(0,a.useCallback)(async()=>{B.current=!1,await (null==u?void 0:u()),b(null),j(null)},[u,j,b]),C=(0,a.useCallback)(()=>{setTimeout(()=>{try{var e;null===(e=f.current)||void 0===e||e.click()}catch(e){}},150)},[]),O=(0,a.useCallback)(async e=>{let n=await (null==t?void 0:t());if((null==n?void 0:n.length)===0){C();return}let{directConnection:s}=null!=e?e:{directConnection:!1};(null==n?void 0:n.length)===1||(null==n?void 0:n.length)>0&&s?(C(),await h(n[0])):x(n)},[C,h,t]);return(0,a.useEffect)(()=>{let e=setTimeout(async()=>{!B.current&&(console.log("settings.autoConnect",m.autoConnect),m.autoConnect&&(B.current=!0,await O({directConnection:!0})))},500);return()=>{clearTimeout(e)}},[m.autoConnect]),(0,s.jsx)(l.Zb,{children:(0,s.jsxs)(l.aY,{className:"flex flex-col flex-wrap gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-row flex-wrap justify-between",children:[(0,s.jsxs)(o.Vq,{children:[(0,s.jsx)(o.hg,{asChild:!0,children:(0,s.jsx)(i.z,{onClick:()=>O(),children:"Connect Wallet"})}),(0,s.jsxs)(o.cZ,{children:[(0,s.jsx)(o.GG,{ref:f}),(0,s.jsxs)(o.fK,{children:[(0,s.jsx)(o.$N,{children:"选择钱包开始连接"}),!!w&&w.map(e=>{var t;return(0,s.jsx)(o.GG,{asChild:!0,children:(0,s.jsxs)(i.z,{onClick:()=>h(e),className:"gap-2",children:[e.logo&&(0,s.jsx)("img",{alt:e.name,src:e.logo,className:"w-5 h-5 rounded-full"}),(0,s.jsx)("span",{className:"font-medium",children:e.name}),null===(t=e.tags)||void 0===t?void 0:t.map(e=>(0,s.jsx)("span",{className:"text-xs font-light",children:e},e))]})},e.id)}),!w||0===w.length&&(0,s.jsxs)(o.Be,{children:["没有钱包可用，请安装 OneKey Extension",(0,s.jsx)("a",{target:"_blank",href:"https://www.onekey.so/download/",children:"Install OneKey Extension →"})]})]})]})]}),v&&(0,s.jsx)(i.z,{variant:"destructive",onClick:S,children:"断开链接"})]}),y&&(0,s.jsx)("div",{className:"flex grid-cols-1 xl:grid-cols-2 flex-wrap gap-x-6 gap-y-3 mt-4",children:Object.keys(y).map(e=>{var t;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{children:["".concat(null!==(t=null==g?void 0:g[e])&&void 0!==t?t:e),": "]}),(0,s.jsx)("span",{className:"font-normal flex flex-wrap text-break",children:"".concat(null==y?void 0:y[e])})]},e)})})]})})}}}]);
//# sourceMappingURL=3525.2a6e13b09718a70a.js.map